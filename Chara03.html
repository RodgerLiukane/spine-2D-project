<style>
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
</style>

<button id="start-btn">Click to Enable Sound</button>
<audio id="voice-player" preload="auto"></audio>

<button onclick="document.getElementById('testAudio').play()">Click to Test Sound</button>
<audio id="testAudio" src="Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_Chat00.wav" preload="auto"></audio>

<script src="https://unpkg.com/@esotericsoftware/spine-player@4.2.*/dist/iife/spine-player.js"></script>
<link rel="stylesheet" href="https://unpkg.com/@esotericsoftware/spine-player@4.2.*/dist/spine-player.css">

<div id="player-container" style="width: 100%; height: 100vh;"></div>

<script>
new spine.SpinePlayer("player-container", {
	
<!-- Spine files are below -->
	
	skeleton: "Chara03_files/Chara03_08072025.json",
	atlas: "Chara03_files/Chara03_08072025.atlas",
  	png: "Chara03_files/Chara03_08072025.png",
	png: "Chara03_files/Chara03_08072025_2.png",
	
<!-- Parameters are below -->
	
	animation: "Blink to Right",
	animations: [
			"Big Surprise",
			"Talking_Bouncing Smile01",
			"Talking_Bouncing Smile02",
			"Talking_Close-Up01",
			"Talking_Close-Up02",
			"Talking_Look Up-Right01",
			"Talking_Look Up-Right02",
			"Talking_Very Happy to Right01",
			"Talking_Very Happy to Right02",
			"Blink to Right", 
			"Bouncing Sad", 
			"Bouncing Scare", 
		     	"Bouncing Smile", 
			"Close-Up",
		     	"Happy to Right", 
		    	"Idle", 
		    	"Idle - Blink", 
		     	"Look Up-Right", 
		     	"Smile to Right",
		     	"Very Happy", 
		     	"Very Happy Delay", 
		     	"Very Happy to Right"
		    ],
	defaultMix: 0.1,
	backgroundColor: "#ffffffff",
	
});
</script>

<!-- Audio element for playback -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const audioPlayer = document.getElementById("voice-player");
  const player = document.querySelector("spine-player");

  if (!player) {
    console.error("Spine player not found.");
    return;
  }

  // Map Spine event names to audio file URLs
  const audioEventMap = {
	"NV_Hylia_Woman_Young_Normal00_SurpriseS00": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal00_SurpriseS00.wav" },
	"NV_Hylia_Woman_Young_Normal01_CallFar00": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_CallFar00.wav" },
	"NV_Hylia_Woman_Young_Normal01_CallFar01": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_CallFar01.wav" },
	"NV_Hylia_Woman_Young_Normal01_Chat00": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_Chat00.wav" },
	"NV_Hylia_Woman_Young_Normal01_Greeting00": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_Greeting00.wav" },
	"NV_Hylia_Woman_Young_Normal01_Greeting01": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_Greeting01.wav" },
	"NV_Hylia_Woman_Young_Normal01_Happy00": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_Happy00.wav" },
	"NV_Hylia_Woman_Young_Normal01_Happy01": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_Happy01.wav" },
	"NV_Hylia_Woman_Young_Normal01_Notice00": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_Notice00.wav" },
	"NV_Hylia_Woman_Young_Normal01_Sad00": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_Sad00.wav" },
	"NV_Hylia_Woman_Young_Normal01_Sad01": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_Sad01.wav" },
	"NV_Hylia_Woman_Young_Normal01_SurpriseL01": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_SurpriseL01.wav" },
	"NV_Hylia_Woman_Young_Normal01_TalkPositive00": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_TalkPositive00.wav" },
	"NV_Hylia_Woman_Young_Normal01_TalkPositive01": { "audio": "Chara03_files/NADIA_audio/NV_Hylia_Woman_Young_Normal01_TalkPositive01.wav" }
  };

let currentAnimation = "";

  player.addEventListener("ready", () => {
    currentAnimation = player.animation.name;
    console.log("Ready. Animation:", currentAnimation);
  });

  player.addEventListener("animation", (e) => {
    currentAnimation = e.detail.name;
    console.log("Switched animation to:", currentAnimation);
  });

  player.addEventListener("event", (e) => {
    console.log("Event triggered:", e.detail.name);
    if (currentAnimation.startsWith("Talking_")) {
      const audioSrc = audioEventMap[e.detail.name];
      if (audioSrc) {
        audioPlayer.src = audioSrc;
        audioPlayer.currentTime = 0;
        audioPlayer.play().catch(err => {
          console.warn("Audio play blocked:", err);
        });
      }
    }
  });
});
</script>
